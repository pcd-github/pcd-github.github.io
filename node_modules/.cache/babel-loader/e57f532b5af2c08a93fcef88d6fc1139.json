{"ast":null,"code":"var _jsxFileName = \"/Users/paul/OneDrive/Documents/code/src/swrve/src/chart.js\",\n    _s = $RefreshSig$();\n\nimport * as React from \"react\";\nimport { useState } from \"react\";\nimport { Stack } from \"@mui/material\";\nimport { Card } from \"@mui/material\";\nimport { CardContent } from \"@mui/material\";\nimport { Typography } from \"@mui/material\";\nimport * as d3 from \"d3\";\nimport SummaryCards from \"./summary.js\";\nimport EndValueChart from './endvaluechart.js';\nimport \"./chartdata.css\";\nimport { histData } from \"./histdata.js\";\nimport { getColorStringForRelativeValue, getPerRunClassName, getPortfolioLineClassName, cleanupPrev, findByID } from './common.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction Chart(props) {\n  _s();\n\n  const [allCycleDataState, setAllCycleDataState] = useState([]);\n  const [allCycleMetaState, setAllCycleMetaState] = useState([]);\n  const [avgAdjEndValueState, setAvgAdjEndValueState] = useState(0);\n  const [medianAdjEndValueState, setMedianAdjEndValueState] = useState(0);\n  const [minAdjEndValueState, setMinAdjEndValueState] = useState(0);\n  const [maxAdjEndValueState, setMaxAdjEndValueState] = useState(0);\n  const [avgSpendState, setAvgSpendState] = useState(0);\n  const [medianSpendState, setMedianSpendState] = useState(0);\n  const [minSpendState, setMinSpendState] = useState(0);\n  const [maxSpendState, setMaxSpendState] = useState(0);\n  const [avgReturnsState, setAvgReturnsState] = useState(0);\n  const [medianReturnsState, setMedianReturnsState] = useState(0);\n  const [minReturnsState, setMinReturnsState] = useState(0);\n  const [maxReturnsState, setMaxReturnsState] = useState(0);\n  const [avgAdjApprState, setAvgAdjAppreciationState] = useState(0);\n  const [medianAdjApprState, setMedianAdjAppreciationState] = useState(0);\n  const [minAdjApprState, setMinAdjAppreciationState] = useState(0);\n  const [maxAdjApprState, setMaxAdjAppreciationState] = useState(0);\n  const [numCyclesState, setNumCyclesState] = useState(0);\n  const [numFailsState, setNumFailsState] = useState(0);\n  const [minFailAgeState, setMinFailAgeState] = useState(0);\n  const [medianFailAgeState, setMedianFailAgeState] = useState(0);\n  const svgCycleChartID = 'd3cycletarget';\n  const perRunClass = getPerRunClassName();\n  const hoverLineID = 'hoverLine';\n  const ttWrapID = 'ttwrapper';\n  const ttBackID = 'ttbackground';\n  const ttAgeID = 'ttage';\n  const margin = {\n    top: 40,\n    right: 65,\n    bottom: 40,\n    left: 65\n  };\n  const totalWidth = 960;\n  const totalHeight = 500;\n  const boundedWidth = totalWidth - margin.left - margin.right;\n  const boundedHeight = totalHeight - margin.top - margin.bottom;\n  const tooltipWidth = 75;\n  const tooltipHeight = 75;\n  const marginTranslate = \"translate(\" + margin.left + \",\" + margin.top + \")\";\n  const normalStrokeWidth = 1.5;\n  var allCycleMeta = [];\n\n  const getXScale = () => {\n    var xExt = [props.currentage, props.lifeexpectancy];\n    return d3.scaleLinear().domain(xExt).range([0, boundedWidth]);\n  };\n\n  const getYScale = (rangeMin, rangeMax) => {\n    var yExt = [rangeMin, rangeMax];\n    return d3.scaleLinear().domain(yExt).range([boundedHeight, 0]);\n  };\n\n  const drawAxes = (svg, xScaleIn, yScaleIn, rangeMin, rangeMax) => {\n    svg.append(\"g\").attr(\"class\", perRunClass).attr(\"transform\", \"translate(0,\" + boundedHeight + \")\").call(d3.axisBottom(xScaleIn));\n    svg.append(\"g\").attr(\"class\", perRunClass).call(d3.axisLeft(yScaleIn));\n  };\n\n  const drawPortfolioLine = (svg, xScaleIn, yScaleIn, oneCycleMeta, oneCycle) => {\n    const classNames = perRunClass + ' ' + getPortfolioLineClassName() + ' ' + oneCycleMeta.lineColor;\n    svg.append(\"path\").datum(oneCycle).attr('id', oneCycleMeta.startYear).attr('class', classNames).attr(\"fill\", \"none\").attr(\"pointer-events\", \"none\").style(\"opacity\", 1).attr(\"stroke\", oneCycleMeta.lineColor).attr(\"stroke-width\", normalStrokeWidth).attr(\"d\", d3.line().x(function (d) {\n      return xScaleIn(d.age);\n    }).y(function (d) {\n      return yScaleIn(d.adjEndValue);\n    }));\n  };\n\n  const prepHoverStuff = svg => {\n    const tooltipWrapper = svg.append('g').attr('id', ttWrapID).attr('display', 'none');\n    tooltipWrapper.append('rect').style('opacity', 0.70).attr('id', ttBackID).attr('width', tooltipWidth).attr('height', tooltipHeight).attr(\"pointer-events\", \"none\").attr(\"fill\", \"#e8e8e8\");\n    const tooltipText = tooltipWrapper.append('g').append('text');\n    tooltipText.attr(\"pointer-events\", \"none\").attr('font-weight', 900).attr('text-anchor', 'left');\n    tooltipText.append('tspan').attr('id', ttAgeID).attr('x', '5').attr('y', '5').attr('dy', '15px').attr(\"pointer-events\", \"none\");\n    svg.append(\"g\").append(\"rect\").style('opacity', 0).attr('id', hoverLineID).attr(\"pointer-events\", \"none\").attr(\"class\", \"dotted\").attr(\"stroke-width\", \"1px\").attr(\"width\", \".5px\").attr(\"height\", boundedHeight);\n  };\n\n  const getHoverLine = () => {\n    return findByID(hoverLineID);\n  };\n\n  const getTooltipWrapper = () => {\n    return findByID(ttWrapID);\n  };\n\n  const getTooltipBackground = () => {\n    return findByID(ttBackID);\n  };\n\n  const getTooltipAgeSpan = () => {\n    return findByID(ttAgeID);\n  };\n\n  const handleMouseOver = e => {\n    getHoverLine().style('opacity', 1);\n    getTooltipWrapper().attr('display', null);\n  };\n\n  const handleMouseMove = e => {\n    const bisect = d3.bisector(d => d.age).left;\n    var xScaleIn = getXScale();\n    const coords = d3.pointer(e);\n    const x0 = xScaleIn.invert(coords[0]);\n    const oneCycleData = allCycleDataState[0];\n    const i = bisect(oneCycleData, x0, 1);\n    const selectedData = oneCycleData[i];\n    const clientX = xScaleIn(selectedData.age);\n    var tooltipX = clientX; // prevent the tooltip from getting clipped.\n\n    const tooltipWidth = 75;\n\n    if (boundedWidth <= clientX + tooltipWidth) {\n      tooltipX = clientX - tooltipWidth;\n    }\n\n    getTooltipAgeSpan().text('age: ' + selectedData.age);\n    const ttBounds = getTooltipWrapper().node().getBBox();\n    getTooltipBackground().attr('width', ttBounds.width).attr('height', ttBounds.height);\n    getTooltipWrapper().attr(\"transform\", \"translate(\" + tooltipX + \",\" + coords[1] + \")\");\n    getHoverLine().attr('x', clientX);\n    getTooltipWrapper().attr('x', tooltipX);\n  };\n\n  const handleMouseLeave = () => {\n    getHoverLine().style('opacity', 0);\n    getTooltipWrapper().attr('display', 'none');\n  };\n  /*\n  const dumpCycleData = (oneCycle) => {\n      for (var i = 0; i < oneCycle.length; i++) {\n           console.log(oneCycle[i].year + \n              ' st:' + makeCurrency(oneCycle[i].beginValue) +\n              ' cpi:' + Number(oneCycle[i].cumulativeCPI).toFixed(2) + \n              ' sp:' + makeCurrency(oneCycle[i].actualSpend) + \n              ' e$:' + makeCurrency(oneCycle[i].equityAppr) +\n              ' d$:' + makeCurrency(oneCycle[i].divAppr) +\n              ' b$:' + makeCurrency(oneCycle[i].bondAppr) +\n              ' f$: ' + makeCurrency(oneCycle[i].fees) + \n              ' ae$: ' + makeCurrency(oneCycle[i].adjEndValue)\n              );\n      }\n  }\n   */\n\n\n  const calcBondYield = (bondStake, histIndex) => {\n    var retValue = 0; // if we're at the end of the cycle, use the simplified calculation\n\n    if (histData.length <= histIndex + 1) {\n      retValue = bondStake * histData[histIndex].bonds;\n    } else {\n      var bg1 = (1 - Math.pow(1 + histData[histIndex + 1].bonds, -9)) * histData[histIndex].bonds;\n      bg1 = bg1 / histData[histIndex + 1].bonds;\n      var bg2 = 1 / Math.pow(1 + histData[histIndex + 1].bonds, 9);\n      bg2 = bg2 - 1;\n      retValue = bondStake * (bg1 + bg2 + histData[histIndex].bonds);\n    }\n\n    return retValue;\n  };\n\n  const findHistStartIndex = startDataYear => {\n    const firstYear = histData[0].year;\n    const offset = startDataYear - firstYear;\n    return offset;\n  };\n\n  const calcAnnualAggReturn = oneYear => {\n    var retVal = obj.equityReturn * stockPct + obj.bondReturn * bondPct;\n  };\n\n  const runCycle = (startIndex, numYears) => {\n    var cycleData = [];\n    const stockPct = +props.stockallocation / 100;\n    const bondPct = +props.bondallocation / 100;\n    const feePct = +props.feepct / 100;\n    const ssAge = +props.ssage;\n    const ssIncome = +props.ssincome;\n    const startCPI = histData[startIndex].cpi;\n\n    for (var i = 0; i < numYears; i++) {\n      var obj = {\n        \"year\": histData[startIndex + i].year,\n        \"age\": +props.currentage + i,\n        \"beginValue\": i > 0 ? cycleData[i - 1].endValue : +props.portfoliovalue,\n        \"equityReturn\": histData[startIndex + i].equity,\n        \"equityAppr\": 0,\n        \"divAppr\": 0,\n        \"bondReturn\": 0,\n        \"bondAppr\": 0,\n        \"aggReturn\": 0,\n        \"cumulativeCPI\": histData[startIndex + i].cpi / startCPI,\n        \"spend\": +props.spendvalue,\n        \"actualSpend\": +props.spendvalue,\n        \"fees\": 0,\n        \"endValue\": 0,\n        \"adjEndValue\": 0,\n        \"appr\": 0,\n        \"adjAppr\": 0\n      }; // adjust spend for cumultative cpi\n\n      obj.actualSpend = obj.spend * obj.cumulativeCPI; // apply ss adjustment if applicable\n\n      var adjustment = ssAge <= obj.age ? ssIncome * obj.cumulativeCPI : 0;\n      obj.actualSpend -= adjustment; // port1 = subtract spend from start port\n\n      obj.endValue = obj.beginValue - obj.actualSpend;\n\n      if (0 < obj.endValue) {\n        var startStockValue = obj.endValue * stockPct; // e growth = port1 * e-share * e-growth\n\n        obj.equityAppr = startStockValue * obj.equityReturn; // calc dividends\n\n        obj.divAppr = startStockValue * histData[startIndex + i].dividends; // b growth = port1 * b=share * b-growth\n\n        obj.bondAppr = calcBondYield(obj.endValue * bondPct, startIndex + i);\n        obj.bondReturn = obj.bondAppr / (obj.beginValue * bondPct);\n        obj.aggReturn = calcAnnualAggReturn(obj, stockPct, bondPct); // port2 = port1 + e-growth + b-growth\n\n        obj.appr = obj.equityAppr + obj.divAppr + obj.bondAppr;\n        obj.endValue += obj.appr; // end port = port2 - (fees (based on cpi-adj value))\n\n        obj.fees = (obj.beginValue + obj.appr) * feePct;\n        obj.endValue -= obj.fees;\n        obj.adjEndValue = obj.endValue / obj.cumulativeCPI;\n        obj.adjAppr = obj.appr / obj.cumulativeCPI;\n        cycleData.push(obj);\n      } else {\n        obj.endValue = obj.adjEndValue = 0;\n        cycleData.push(obj);\n        break;\n      }\n    }\n\n    return cycleData;\n  };\n\n  const getAggReturns = allCycles => {\n    var retVal = [];\n\n    for (var iCycle = 0; iCycle < allCycles.length; iCycle++) {\n      for (var year = 0; year < allCycles[iCycle].length; year++) {\n        const oneYear = allCycles[iCycle][year];\n        retVal.push(oneYear.aggReturn);\n      }\n    }\n\n    return retVal;\n  };\n\n  const calcCycleMeta = (oneCycle, lifetime) => {\n    var extAdjEndValue = d3.extent(oneCycle, d => d.adjEndValue);\n    var avgAdjEndValue = d3.mean(oneCycle, d => d.adjEndValue);\n    var medAdjEndValue = d3.median(oneCycle, d => d.adjEndValue);\n    var totalSpend = d3.sum(oneCycle, d => d.actualSpend);\n    var totalAppr = d3.sum(oneCycle, d => d.appr);\n    var totalAdjAppr = d3.sum(oneCycle, d => d.adjAppr);\n    var pctStart = oneCycle[oneCycle.length - 1].adjEndValue / props.portfoliovalue;\n    const thisLineColor = getColorStringForRelativeValue(pctStart);\n    var extAggReturn = d3.extent(oneCycle, d => d.aggReturn);\n    var avgAggReturn = d3.mean(oneCycle, d => d.aggReturn);\n    var medAggReturn = d3.median(oneCycle, d => d.aggReturn);\n    var oneMeta = {\n      'startCycleValue': props.portfoliovalue,\n      'endCycleValue': oneCycle[oneCycle.length - 1].endValue,\n      'adjEndCycleValue': oneCycle[oneCycle.length - 1].adjEndValue,\n      'extent': extAdjEndValue,\n      'mean': avgAdjEndValue,\n      'median': medAdjEndValue,\n      'pctOfStart': pctStart,\n      'totalSpend': totalSpend,\n      'totalAppreciation': totalAppr,\n      'totalAdjAppreciation': totalAdjAppr,\n      'extAggReturn': extAggReturn,\n      'avgAggReturn': avgAggReturn,\n      'medAggReturn': medAggReturn,\n      'fail': 0 >= oneCycle[oneCycle.length - 1].adjEndValue,\n      'failAge': 0 >= oneCycle[oneCycle.length - 1].adjEndValue ? oneCycle.length + props.currentage : undefined,\n      'startYear': oneCycle[0].year,\n      'lineColor': thisLineColor\n    };\n    return oneMeta;\n  };\n\n  const calcSummaryData = allCycles => {\n    var extAdjEnd = d3.extent(allCycleMeta, d => d.adjEndCycleValue);\n    var avgAdjEnd = d3.mean(allCycleMeta, d => d.adjEndCycleValue);\n    var medAdjEnd = d3.median(allCycleMeta, d => d.adjEndCycleValue);\n    var avgSpend = d3.mean(allCycleMeta, d => d.totalSpend);\n    var medianSpend = d3.median(allCycleMeta, d => d.totalSpend);\n    var extSpend = d3.extent(allCycleMeta, d => d.totalSpend);\n    var aggReturns = getAggReturns(allCycles);\n    var avgReturns = d3.mean(aggReturns);\n    var medianReturns = d3.median(aggReturns);\n    var extReturns = d3.extent(aggReturns);\n    var avgAdjAppr = d3.mean(allCycleMeta, d => d.totalAdjAppreciation);\n    var medianAdjAppr = d3.median(allCycleMeta, d => d.totalAdjAppreciation);\n    var extAdjAppr = d3.extent(allCycleMeta, d => d.totalAdjAppreciation);\n    var numFails = 0;\n    var minFailAge = props.lifeexpectancy + 1;\n    var failAges = [];\n\n    for (var i = 0; i < allCycleMeta.length; i++) {\n      if (allCycleMeta[i].fail) {\n        minFailAge = Math.min(allCycleMeta[i].failAge, minFailAge);\n        failAges[numFails] = allCycleMeta[i].failAge;\n        numFails++;\n      }\n    }\n\n    setAvgAdjEndValueState(avgAdjEnd);\n    setMedianAdjEndValueState(medAdjEnd);\n    setMinAdjEndValueState(extAdjEnd[0]);\n    setMaxAdjEndValueState(extAdjEnd[1]);\n    setAvgSpendState(avgSpend);\n    setMedianSpendState(medianSpend);\n    setMinSpendState(extSpend[0]);\n    setMaxSpendState(extSpend[1]);\n    setAvgReturnsState(avgReturns);\n    setMedianReturnsState(medianReturns);\n    setMinReturnsState(extReturns[0]);\n    setMaxReturnsState(extReturns[1]);\n    setAvgAdjAppreciationState(avgAdjAppr);\n    setMedianAdjAppreciationState(medianAdjAppr);\n    setMinAdjAppreciationState(extAdjAppr[0]);\n    setMaxAdjAppreciationState(extAdjAppr[1]);\n    setNumCyclesState(allCycleMeta.length);\n    setNumFailsState(numFails);\n    setMinFailAgeState(minFailAge);\n    setMedianFailAgeState(d3.median(failAges));\n  };\n\n  const calcCycles = svg => {\n    const lifetime = props.lifeexpectancy - props.currentage + 1;\n    const startDataYear = props.startdatayear;\n    const endDataYear = props.enddatayear; // TODO : require numCycles to be greater than zero\n\n    const numCycles = endDataYear - startDataYear + 2 - lifetime;\n    const startIndex = findHistStartIndex(startDataYear);\n    var portMin = Number.POSITIVE_INFINITY;\n    var portMax = Number.NEGATIVE_INFINITY;\n    var allCycles = [];\n    cleanupPrev();\n\n    for (var i = 0; i < numCycles; i++) {\n      var oneCycle = runCycle(startIndex + i, lifetime);\n      var cycleMeta = calcCycleMeta(oneCycle, lifetime);\n      allCycleMeta[i] = cycleMeta;\n      allCycles[i] = oneCycle;\n      portMin = Math.min(portMin, cycleMeta.extent[0]);\n      portMax = Math.max(portMax, cycleMeta.extent[1]);\n    }\n\n    setAllCycleDataState(allCycles);\n    setAllCycleMetaState(allCycleMeta);\n    calcSummaryData(allCycles);\n    const xScale = getXScale();\n    const yScale = getYScale(portMin, portMax);\n    drawAxes(svg, xScale, yScale, portMin, portMax);\n\n    for (i = 0; i < numCycles; i++) {\n      drawPortfolioLine(svg, xScale, yScale, allCycleMeta[i], allCycles[i]);\n    }\n  };\n\n  React.useEffect(() => {\n    const svg = findByID(svgCycleChartID).append(\"g\").attr(\"transform\", marginTranslate);\n    calcCycles(svg);\n    prepHoverStuff(svg);\n  }, [props]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(SummaryCards, {\n      fails: numFailsState,\n      cycles: numCyclesState,\n      minfailage: minFailAgeState,\n      medianfailage: medianFailAgeState,\n      medianendvalue: medianAdjEndValueState,\n      avgendvalue: avgAdjEndValueState,\n      minendvalue: minAdjEndValueState,\n      maxendvalue: maxAdjEndValueState,\n      medianreturns: medianReturnsState,\n      avgreturns: avgReturnsState,\n      minreturns: minReturnsState,\n      maxreturns: maxReturnsState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 474,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n      id: svgCycleChartID,\n      width: totalWidth,\n      height: totalHeight,\n      children: /*#__PURE__*/_jsxDEV(\"rect\", {\n        id: \"trackingRect\",\n        style: {\n          opacity: 0\n        },\n        width: boundedWidth,\n        height: boundedHeight,\n        transform: marginTranslate,\n        fill: \"LightGrey\",\n        onMouseEnter: handleMouseOver,\n        onMouseMove: handleMouseMove,\n        onMouseLeave: handleMouseLeave\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 486,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 482,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(EndValueChart, {\n      startvalue: props.portfoliovalue,\n      minendvalue: minAdjEndValueState,\n      maxendvalue: maxAdjEndValueState,\n      medianendvalue: medianAdjEndValueState,\n      metadata: allCycleMetaState,\n      cyclechartid: svgCycleChartID\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 497,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 473,\n    columnNumber: 9\n  }, this);\n}\n\n_s(Chart, \"8NBpq0mB72Exuzg7g16Y8gKTunk=\");\n\n_c = Chart;\n;\nexport default Chart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Chart\");","map":{"version":3,"sources":["/Users/paul/OneDrive/Documents/code/src/swrve/src/chart.js"],"names":["React","useState","Stack","Card","CardContent","Typography","d3","SummaryCards","EndValueChart","histData","getColorStringForRelativeValue","getPerRunClassName","getPortfolioLineClassName","cleanupPrev","findByID","Chart","props","allCycleDataState","setAllCycleDataState","allCycleMetaState","setAllCycleMetaState","avgAdjEndValueState","setAvgAdjEndValueState","medianAdjEndValueState","setMedianAdjEndValueState","minAdjEndValueState","setMinAdjEndValueState","maxAdjEndValueState","setMaxAdjEndValueState","avgSpendState","setAvgSpendState","medianSpendState","setMedianSpendState","minSpendState","setMinSpendState","maxSpendState","setMaxSpendState","avgReturnsState","setAvgReturnsState","medianReturnsState","setMedianReturnsState","minReturnsState","setMinReturnsState","maxReturnsState","setMaxReturnsState","avgAdjApprState","setAvgAdjAppreciationState","medianAdjApprState","setMedianAdjAppreciationState","minAdjApprState","setMinAdjAppreciationState","maxAdjApprState","setMaxAdjAppreciationState","numCyclesState","setNumCyclesState","numFailsState","setNumFailsState","minFailAgeState","setMinFailAgeState","medianFailAgeState","setMedianFailAgeState","svgCycleChartID","perRunClass","hoverLineID","ttWrapID","ttBackID","ttAgeID","margin","top","right","bottom","left","totalWidth","totalHeight","boundedWidth","boundedHeight","tooltipWidth","tooltipHeight","marginTranslate","normalStrokeWidth","allCycleMeta","getXScale","xExt","currentage","lifeexpectancy","scaleLinear","domain","range","getYScale","rangeMin","rangeMax","yExt","drawAxes","svg","xScaleIn","yScaleIn","append","attr","call","axisBottom","axisLeft","drawPortfolioLine","oneCycleMeta","oneCycle","classNames","lineColor","datum","startYear","style","line","x","d","age","y","adjEndValue","prepHoverStuff","tooltipWrapper","tooltipText","getHoverLine","getTooltipWrapper","getTooltipBackground","getTooltipAgeSpan","handleMouseOver","e","handleMouseMove","bisect","bisector","coords","pointer","x0","invert","oneCycleData","i","selectedData","clientX","tooltipX","text","ttBounds","node","getBBox","width","height","handleMouseLeave","calcBondYield","bondStake","histIndex","retValue","length","bonds","bg1","Math","pow","bg2","findHistStartIndex","startDataYear","firstYear","year","offset","calcAnnualAggReturn","oneYear","retVal","obj","equityReturn","stockPct","bondReturn","bondPct","runCycle","startIndex","numYears","cycleData","stockallocation","bondallocation","feePct","feepct","ssAge","ssage","ssIncome","ssincome","startCPI","cpi","endValue","portfoliovalue","equity","spendvalue","actualSpend","spend","cumulativeCPI","adjustment","beginValue","startStockValue","equityAppr","divAppr","dividends","bondAppr","aggReturn","appr","fees","adjAppr","push","getAggReturns","allCycles","iCycle","calcCycleMeta","lifetime","extAdjEndValue","extent","avgAdjEndValue","mean","medAdjEndValue","median","totalSpend","sum","totalAppr","totalAdjAppr","pctStart","thisLineColor","extAggReturn","avgAggReturn","medAggReturn","oneMeta","undefined","calcSummaryData","extAdjEnd","adjEndCycleValue","avgAdjEnd","medAdjEnd","avgSpend","medianSpend","extSpend","aggReturns","avgReturns","medianReturns","extReturns","avgAdjAppr","totalAdjAppreciation","medianAdjAppr","extAdjAppr","numFails","minFailAge","failAges","fail","min","failAge","calcCycles","startdatayear","endDataYear","enddatayear","numCycles","portMin","Number","POSITIVE_INFINITY","portMax","NEGATIVE_INFINITY","cycleMeta","max","xScale","yScale","useEffect","opacity"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport {useState} from \"react\";\nimport { Stack } from \"@mui/material\";\nimport { Card } from \"@mui/material\";\nimport { CardContent } from \"@mui/material\";\nimport { Typography } from \"@mui/material\";\nimport * as d3 from \"d3\";\nimport SummaryCards from \"./summary.js\";\nimport EndValueChart from './endvaluechart.js';\nimport \"./chartdata.css\";\nimport { histData } from \"./histdata.js\";\nimport {getColorStringForRelativeValue, getPerRunClassName, getPortfolioLineClassName, cleanupPrev, findByID} from './common.js';\n\nfunction Chart (props) {\n  \n    const [allCycleDataState, setAllCycleDataState] = useState([]);\n    const [allCycleMetaState, setAllCycleMetaState] = useState([]);\n\n    const [avgAdjEndValueState, setAvgAdjEndValueState] = useState(0);\n    const [medianAdjEndValueState, setMedianAdjEndValueState] = useState(0);\n    const [minAdjEndValueState, setMinAdjEndValueState] = useState(0);\n    const [maxAdjEndValueState, setMaxAdjEndValueState] = useState(0);\n\n    const [avgSpendState, setAvgSpendState] = useState(0);\n    const [medianSpendState, setMedianSpendState] = useState(0);\n    const [minSpendState, setMinSpendState] = useState(0);\n    const [maxSpendState, setMaxSpendState] = useState(0);\n\n    const [avgReturnsState, setAvgReturnsState] = useState(0);\n    const [medianReturnsState, setMedianReturnsState] = useState(0);\n    const [minReturnsState, setMinReturnsState] = useState(0);\n    const [maxReturnsState, setMaxReturnsState] = useState(0);\n    \n    const [avgAdjApprState, setAvgAdjAppreciationState] = useState(0);\n    const [medianAdjApprState, setMedianAdjAppreciationState] = useState(0);\n    const [minAdjApprState, setMinAdjAppreciationState] = useState(0);\n    const [maxAdjApprState, setMaxAdjAppreciationState] = useState(0);\n    \n    const [numCyclesState, setNumCyclesState] = useState(0);\n    const [numFailsState, setNumFailsState] = useState(0);\n    const [minFailAgeState, setMinFailAgeState] = useState(0);\n    const [medianFailAgeState, setMedianFailAgeState] = useState(0);\n\n    const svgCycleChartID = 'd3cycletarget';\n    const perRunClass = getPerRunClassName();\n    const hoverLineID = 'hoverLine';\n    const ttWrapID = 'ttwrapper';\n    const ttBackID = 'ttbackground';\n    const ttAgeID = 'ttage';\n    const margin = { top: 40, right: 65, bottom: 40, left: 65 };\n    const totalWidth = 960;\n    const totalHeight = 500;\n    const boundedWidth = totalWidth - margin.left - margin.right;\n    const boundedHeight = totalHeight - margin.top - margin.bottom;\n    const tooltipWidth = 75;\n    const tooltipHeight = 75;\n    const marginTranslate = \"translate(\" + margin.left + \",\" + margin.top + \")\";\n    const normalStrokeWidth = 1.5;\n    var allCycleMeta = [];\n\n    const getXScale = () => { \n        var xExt = [props.currentage, props.lifeexpectancy];\n        return d3.scaleLinear()\n                    .domain(xExt)\n                    .range([ 0, boundedWidth ]);\n    }\n\n    const getYScale = (rangeMin, rangeMax) => {\n        var yExt = [rangeMin, rangeMax];\n        return d3.scaleLinear()\n                    .domain(yExt)\n                    .range([ boundedHeight, 0 ]);\n    }\n\n    const drawAxes = (svg, xScaleIn, yScaleIn, rangeMin, rangeMax) => {\n \n        svg.append(\"g\")\n            .attr(\"class\", perRunClass)\n            .attr(\"transform\", \"translate(0,\" + boundedHeight + \")\")\n            .call(d3.axisBottom(xScaleIn));\n        svg.append(\"g\")\n            .attr(\"class\", perRunClass)\n            .call(d3.axisLeft(yScaleIn));\n    };\n\n    const drawPortfolioLine = (svg, xScaleIn, yScaleIn, oneCycleMeta, oneCycle) => {\n\n        const classNames = perRunClass + ' ' \n                            + getPortfolioLineClassName() + ' ' \n                            + oneCycleMeta.lineColor;\n        svg.append(\"path\")\n            .datum(oneCycle)\n            .attr('id', oneCycleMeta.startYear)\n            .attr('class', classNames)\n            .attr(\"fill\", \"none\")\n            .attr(\"pointer-events\", \"none\")\n            .style(\"opacity\", 1)\n            .attr(\"stroke\", oneCycleMeta.lineColor)\n            .attr(\"stroke-width\", normalStrokeWidth)\n            .attr(\"d\", d3.line()\n                        .x(function(d) { return xScaleIn(d.age) })\n                        .y(function(d) { return yScaleIn(d.adjEndValue) })\n            );        \n    }\n\n    const prepHoverStuff = (svg) => {\n        const tooltipWrapper = svg\n                .append('g')\n                .attr('id', ttWrapID)\n                .attr('display', 'none');\n        \n        tooltipWrapper.append('rect')\n                        .style('opacity', 0.70)\n                        .attr('id', ttBackID)\n                        .attr('width', tooltipWidth)\n                        .attr('height', tooltipHeight)\n                        .attr(\"pointer-events\", \"none\")\n                        .attr(\"fill\", \"#e8e8e8\"); \n\n        const tooltipText = tooltipWrapper.append('g').append('text');\n\n        tooltipText.attr(\"pointer-events\", \"none\")\n                    .attr('font-weight', 900)\n                    .attr('text-anchor', 'left');\n                    \n        tooltipText.append('tspan')\n                    .attr('id', ttAgeID)\n                    .attr('x', '5')\n                    .attr('y', '5')\n                    .attr('dy', '15px')\n                    .attr(\"pointer-events\", \"none\");\n\n        svg.append(\"g\")\n           .append(\"rect\")\n            .style('opacity', 0)\n            .attr('id', hoverLineID)\n            .attr(\"pointer-events\", \"none\")\n            .attr(\"class\", \"dotted\")\n            .attr(\"stroke-width\", \"1px\")\n            .attr(\"width\", \".5px\")\n            .attr(\"height\", boundedHeight);\n        \n    }\n\n    const getHoverLine = () => {\n        return findByID(hoverLineID);\n    }\n\n    const getTooltipWrapper = () => {\n        return findByID(ttWrapID);\n    }\n\n    const getTooltipBackground = () => {\n        return findByID(ttBackID);\n    }\n\n    const getTooltipAgeSpan = () => {\n        return findByID(ttAgeID);\n    }\n\n    const handleMouseOver = (e) => {\n        getHoverLine().style('opacity', 1);\n        getTooltipWrapper().attr('display', null);\n    }\n\n    const handleMouseMove = (e) => {\n        const bisect = d3.bisector((d) => d.age).left;\n        var xScaleIn = getXScale();\n        const coords = d3.pointer(e);\n        const x0 = xScaleIn.invert(coords[0]);\n        const oneCycleData = allCycleDataState[0];\n        const i = bisect(oneCycleData, x0, 1);\n        const selectedData = oneCycleData[i];\n        const clientX = xScaleIn(selectedData.age);\n        var tooltipX = clientX;\n        \n        // prevent the tooltip from getting clipped.\n        const tooltipWidth = 75;             \n        if (boundedWidth <= (clientX + tooltipWidth)) {\n            tooltipX = clientX - tooltipWidth;\n        }\n        getTooltipAgeSpan().text('age: ' + selectedData.age);\n\n        const ttBounds = getTooltipWrapper().node().getBBox();\n        getTooltipBackground()                \n            .attr('width', ttBounds.width)\n            .attr('height', ttBounds.height);\n\n        getTooltipWrapper().attr(\"transform\", \"translate(\" + tooltipX + \",\" + coords[1] + \")\");  \n\n        getHoverLine().attr('x', clientX);\n        getTooltipWrapper().attr('x', tooltipX);\n    };\n    \n    const handleMouseLeave = () => {\n        getHoverLine().style('opacity', 0);\n        getTooltipWrapper().attr('display', 'none');\n    };\n\n    /*\n    const dumpCycleData = (oneCycle) => {\n        for (var i = 0; i < oneCycle.length; i++) {\n\n            console.log(oneCycle[i].year + \n                ' st:' + makeCurrency(oneCycle[i].beginValue) +\n                ' cpi:' + Number(oneCycle[i].cumulativeCPI).toFixed(2) + \n                ' sp:' + makeCurrency(oneCycle[i].actualSpend) + \n                ' e$:' + makeCurrency(oneCycle[i].equityAppr) +\n                ' d$:' + makeCurrency(oneCycle[i].divAppr) +\n                ' b$:' + makeCurrency(oneCycle[i].bondAppr) +\n                ' f$: ' + makeCurrency(oneCycle[i].fees) + \n                ' ae$: ' + makeCurrency(oneCycle[i].adjEndValue)\n                );\n        }\n    }\n     */\n\n    const calcBondYield = (bondStake, histIndex) => {\n        \n        var retValue = 0;\n\n        // if we're at the end of the cycle, use the simplified calculation\n        if (histData.length <= (histIndex + 1)) {\n            retValue = bondStake * histData[histIndex].bonds;\n        }\n        else {\n            var bg1 = (1 - Math.pow(1 + histData[histIndex + 1].bonds, -9 ))\n                      * histData[histIndex].bonds;\n            bg1 = bg1 / histData[histIndex + 1].bonds;\n            \n            var bg2 = 1 / Math.pow(1 + histData[histIndex + 1].bonds, 9);\n            bg2 = bg2 - 1;\n\n            retValue = bondStake * (bg1 + bg2 + histData[histIndex].bonds);\n        }\n\n        return retValue;\n    }\n\n    const findHistStartIndex = (startDataYear) => {\n        const firstYear = histData[0].year;\n        const offset = startDataYear - firstYear;\n\n        return offset;\n    }\n\n    const calcAnnualAggReturn = (oneYear) => {\n\n        var retVal = \n        (obj.equityReturn * stockPct) + (obj.bondReturn * bondPct);\n    }\n    const runCycle = (startIndex, numYears) => {\n        var cycleData = [];\n        const stockPct = +(props.stockallocation) / 100;\n        const bondPct = +(props.bondallocation) / 100;\n        const feePct = +(props.feepct) / 100;\n        const ssAge = +(props.ssage);\n        const ssIncome = +(props.ssincome);\n        const startCPI = histData[startIndex].cpi;\n\n        for(var i = 0; i < numYears; i++){\n            var obj = { \"year\": histData[startIndex + i].year,\n                        \"age\": +(props.currentage) + i,\n                        \"beginValue\": (i > 0) ? cycleData[i - 1].endValue : +(props.portfoliovalue),\n                        \"equityReturn\": histData[startIndex + i].equity,\n                        \"equityAppr\": 0,\n                        \"divAppr\": 0,\n                        \"bondReturn\": 0,\n                        \"bondAppr\": 0,\n                        \"aggReturn\": 0,\n                        \"cumulativeCPI\": histData[startIndex + i].cpi / startCPI,\n                        \"spend\": +(props.spendvalue),\n                        \"actualSpend\": +(props.spendvalue),\n                        \"fees\": 0,\n                        \"endValue\": 0,\n                        \"adjEndValue\": 0,\n                        \"appr\": 0,\n                        \"adjAppr\": 0,\n                      };\n            // adjust spend for cumultative cpi\n            obj.actualSpend = obj.spend * obj.cumulativeCPI;\n            // apply ss adjustment if applicable\n            var adjustment = (ssAge <= obj.age) ? (ssIncome * obj.cumulativeCPI) : 0;\n            obj.actualSpend -= adjustment;\n            // port1 = subtract spend from start port\n            obj.endValue = obj.beginValue - obj.actualSpend;\n            if (0 < obj.endValue) {\n                var startStockValue = obj.endValue * stockPct;\n                // e growth = port1 * e-share * e-growth\n                obj.equityAppr = startStockValue * obj.equityReturn;\n                // calc dividends\n                obj.divAppr = startStockValue * histData[startIndex + i].dividends;\n                // b growth = port1 * b=share * b-growth\n                obj.bondAppr = calcBondYield(obj.endValue * bondPct, startIndex + i);\n                obj.bondReturn = obj.bondAppr / (obj.beginValue * bondPct);\n                obj.aggReturn = calcAnnualAggReturn(obj, stockPct, bondPct);\n                // port2 = port1 + e-growth + b-growth\n                obj.appr = obj.equityAppr + obj.divAppr + obj.bondAppr;\n                obj.endValue += obj.appr;\n                // end port = port2 - (fees (based on cpi-adj value))\n                obj.fees = (obj.beginValue + obj.appr) * feePct;\n                obj.endValue -= obj.fees;\n                obj.adjEndValue = obj.endValue / obj.cumulativeCPI;\n                obj.adjAppr = obj.appr / obj.cumulativeCPI;\n                cycleData.push(obj);\n            }\n            else {\n                obj.endValue = obj.adjEndValue = 0;\n                cycleData.push(obj);\n                break;\n            }\n        }\n        return cycleData;\n    }\n\n    const getAggReturns = (allCycles) => {\n        var retVal = [];\n\n        for (var iCycle = 0; iCycle < allCycles.length; iCycle++) {\n            for (var year = 0; year < allCycles[iCycle].length; year++) {\n                const oneYear = allCycles[iCycle][year];\n                retVal.push(oneYear.aggReturn);\n            }\n        }\n\n        return retVal;\n    }\n\n    const calcCycleMeta = (oneCycle, lifetime) => {\n        var extAdjEndValue = d3.extent(oneCycle, (d) => d.adjEndValue);\n        var avgAdjEndValue = d3.mean(oneCycle, (d) => d.adjEndValue);\n        var medAdjEndValue = d3.median(oneCycle, (d) => d.adjEndValue);\n        var totalSpend = d3.sum(oneCycle, (d) => d.actualSpend);\n        var totalAppr = d3.sum(oneCycle, (d) => d.appr);\n        var totalAdjAppr = d3.sum(oneCycle, (d) => d.adjAppr);\n        var pctStart = oneCycle[oneCycle.length - 1].adjEndValue / props.portfoliovalue;\n        const thisLineColor = getColorStringForRelativeValue(pctStart);\n        var extAggReturn = d3.extent(oneCycle, (d) => d.aggReturn);\n        var avgAggReturn = d3.mean(oneCycle, (d) => d.aggReturn);\n        var medAggReturn = d3.median(oneCycle, (d) => d.aggReturn);\n\n        var oneMeta = {\n            'startCycleValue': props.portfoliovalue,\n            'endCycleValue': oneCycle[oneCycle.length - 1].endValue,\n            'adjEndCycleValue': oneCycle[oneCycle.length - 1].adjEndValue,\n            'extent': extAdjEndValue,\n            'mean': avgAdjEndValue,\n            'median': medAdjEndValue,\n            'pctOfStart': pctStart,\n            'totalSpend': totalSpend,\n            'totalAppreciation': totalAppr,\n            'totalAdjAppreciation': totalAdjAppr,\n            'extAggReturn': extAggReturn,\n            'avgAggReturn': avgAggReturn,\n            'medAggReturn': medAggReturn,\n            'fail': (0 >= oneCycle[oneCycle.length - 1].adjEndValue),\n            'failAge': (0 >= oneCycle[oneCycle.length - 1].adjEndValue) ? \n                       (oneCycle.length + props.currentage) :\n                       undefined,\n            'startYear': oneCycle[0].year,\n            'lineColor': thisLineColor,\n        };\n\n        return oneMeta;\n    }\n\n    const calcSummaryData = (allCycles) => {\n\n        var extAdjEnd = d3.extent(allCycleMeta, (d) => d.adjEndCycleValue);\n        var avgAdjEnd = d3.mean(allCycleMeta, (d) => d.adjEndCycleValue);\n        var medAdjEnd = d3.median(allCycleMeta, (d) => d.adjEndCycleValue);\n\n        var avgSpend = d3.mean(allCycleMeta, (d) => d.totalSpend);        \n        var medianSpend = d3.median(allCycleMeta, (d) => d.totalSpend);\n        var extSpend = d3.extent(allCycleMeta, (d) => d.totalSpend);\n\n        var aggReturns = getAggReturns(allCycles);\n        var avgReturns = d3.mean(aggReturns);\n        var medianReturns = d3.median(aggReturns);\n        var extReturns = d3.extent(aggReturns);\n\n        var avgAdjAppr = d3.mean(allCycleMeta, (d) => d.totalAdjAppreciation);\n        var medianAdjAppr = d3.median(allCycleMeta, (d) => d.totalAdjAppreciation);\n        var extAdjAppr = d3.extent(allCycleMeta, (d) => d.totalAdjAppreciation);\n\n        var numFails = 0;\n        var minFailAge = props.lifeexpectancy + 1;\n        var failAges = [];\n\n        for (var i = 0; i < allCycleMeta.length; i++) {\n            if (allCycleMeta[i].fail) {\n                minFailAge = Math.min(allCycleMeta[i].failAge, minFailAge);\n                failAges[numFails] = allCycleMeta[i].failAge;\n                numFails++;\n            }\n        }\n\n        setAvgAdjEndValueState(avgAdjEnd);\n        setMedianAdjEndValueState(medAdjEnd);\n        setMinAdjEndValueState(extAdjEnd[0]);\n        setMaxAdjEndValueState(extAdjEnd[1]);\n\n        setAvgSpendState(avgSpend);\n        setMedianSpendState(medianSpend);\n        setMinSpendState(extSpend[0]);\n        setMaxSpendState(extSpend[1]);\n\n        setAvgReturnsState(avgReturns);\n        setMedianReturnsState(medianReturns);\n        setMinReturnsState(extReturns[0]);\n        setMaxReturnsState(extReturns[1]);\n\n        setAvgAdjAppreciationState(avgAdjAppr);\n        setMedianAdjAppreciationState(medianAdjAppr);\n        setMinAdjAppreciationState(extAdjAppr[0]);\n        setMaxAdjAppreciationState(extAdjAppr[1]);\n\n        setNumCyclesState(allCycleMeta.length);\n        setNumFailsState(numFails);\n        setMinFailAgeState(minFailAge);\n        setMedianFailAgeState(d3.median(failAges));\n    }\n\n    const calcCycles = (svg) => {\n        const lifetime = props.lifeexpectancy - props.currentage + 1;\n        const startDataYear = props.startdatayear;\n        const endDataYear = props.enddatayear;\n        // TODO : require numCycles to be greater than zero\n        const numCycles = (endDataYear - startDataYear + 2) - lifetime;\n        const startIndex = findHistStartIndex(startDataYear);\n        var portMin = Number.POSITIVE_INFINITY;\n        var portMax = Number.NEGATIVE_INFINITY;\n        var allCycles = [];\n\n        cleanupPrev();\n\n        for (var i = 0; i < numCycles; i++) {\n            var oneCycle = runCycle(startIndex + i, lifetime);\n            var cycleMeta = calcCycleMeta(oneCycle, lifetime);\n            \n            allCycleMeta[i] = cycleMeta;\n            allCycles[i] = oneCycle;\n\n            portMin = Math.min(portMin, cycleMeta.extent[0]);\n            portMax = Math.max(portMax, cycleMeta.extent[1]);\n        }\n\n        setAllCycleDataState(allCycles);\n        setAllCycleMetaState(allCycleMeta);\n\n        calcSummaryData(allCycles);\n\n        const xScale = getXScale();\n        const yScale = getYScale(portMin, portMax);\n\n        drawAxes(svg, xScale, yScale, portMin, portMax);\n        for (i = 0; i < numCycles; i++) {\n            drawPortfolioLine(svg, xScale, yScale, allCycleMeta[i], allCycles[i]);\n        }\n    }\n\n    React.useEffect(() => {\n\n        const svg = findByID(svgCycleChartID)\n                      .append(\"g\")\n                      .attr(\"transform\", marginTranslate);\n        calcCycles(svg);\n\n        prepHoverStuff(svg);\n    }, [props] );\n\n    return (\n        <div>\n            <SummaryCards \n             fails={numFailsState} cycles={numCyclesState}\n             minfailage={minFailAgeState} medianfailage={medianFailAgeState} \n             medianendvalue={medianAdjEndValueState} avgendvalue={avgAdjEndValueState}\n             minendvalue={minAdjEndValueState} maxendvalue={maxAdjEndValueState}\n             medianreturns={medianReturnsState} avgreturns={avgReturnsState}\n             minreturns={minReturnsState} maxreturns={maxReturnsState}\n             />\n            <svg id={svgCycleChartID} \n                    width={totalWidth}\n                    height={totalHeight} \n            >\n                <rect id='trackingRect'\n                    style={{ opacity:0 }}\n                    width={boundedWidth}\n                    height={boundedHeight}\n                    transform={marginTranslate}\n                    fill='LightGrey'\n                    onMouseEnter={handleMouseOver}\n                    onMouseMove={handleMouseMove}\n                    onMouseLeave={handleMouseLeave}\n                />\n            </svg>  \n            <EndValueChart \n             startvalue={props.portfoliovalue} \n             minendvalue={minAdjEndValueState} \n             maxendvalue={maxAdjEndValueState} \n             medianendvalue={medianAdjEndValueState}\n             metadata={allCycleMetaState} \n             cyclechartid={svgCycleChartID} />            \n        </div>\n    );\n};\n\nexport default Chart;\n"]},"metadata":{},"sourceType":"module"}