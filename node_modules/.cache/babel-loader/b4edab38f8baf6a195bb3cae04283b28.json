{"ast":null,"code":"var _jsxFileName = \"/Users/paul/OneDrive/Documents/code/src/swrve/src/endvaluechart.js\",\n    _s = $RefreshSig$();\n\nimport * as React from \"react\";\nimport * as d3 from \"d3\";\nimport { useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction EndValueChart(props) {\n  _s();\n\n  const maxPctOfStart = props.maxendvalue / props.startvalue;\n  const svgID = 'endvaluechartsvg';\n  const perRunClass = 'perrunevdata';\n  const ttBinWrapID = 'binttwrapper';\n  const ttBinBackID = 'binttback';\n  const ttBinRangeID = 'binrange';\n  const margin = {\n    top: 40,\n    right: 65,\n    bottom: 40,\n    left: 65\n  };\n  const totalWidth = 960;\n  const totalHeight = 300;\n  const marginTranslate = \"translate(\" + margin.left + \",\" + margin.top + \")\";\n  const boundedWidth = totalWidth - margin.left - margin.right;\n  const boundedHeight = totalHeight - margin.top - margin.bottom;\n  const tooltipWidth = 75;\n  const tooltipHeight = 75;\n  const thresholdValues = [0, 0.25, 0.5, 1, 3, 5, 10, 50];\n\n  const cleanupPrev = svg => {\n    const perRunSelect = '.' + perRunClass;\n    d3.selectAll(perRunSelect).remove();\n  };\n\n  const getXScaleForAxis = () => {\n    const numThresholds = thresholdValues.length;\n    var thresholdRange = [];\n    var thresholdInc = boundedWidth / (numThresholds + 1);\n\n    for (var i = 0; i <= thresholdValues.length; i++) {\n      thresholdRange[i] = i * thresholdInc;\n    }\n\n    return d3.scaleThreshold().domain(thresholdValues).range(thresholdRange);\n  };\n\n  const prepTooltip = svg => {\n    // wrapper\n    // background\n    // text element\n    //  tspan for each line\n    //  x0, x1, % of start, % of results\n    const tooltipWrapper = svg.append('g').attr('id', ttBinWrapID).attr('display', 'none');\n    tooltipWrapper.append('rect').style('opacity', 0.70).attr('id', ttBinBackID).attr('width', tooltipWidth).attr('height', tooltipHeight).attr(\"pointer-events\", \"none\").attr(\"fill\", \"#e8e8e8\");\n    const tooltipText = tooltipWrapper.append('g').append('text');\n    tooltipText.attr(\"pointer-events\", \"none\").attr('font-weight', 900).attr('text-anchor', 'left');\n    tooltipText.append('tspan').attr('id', ttBinRangeID).attr('x', '5').attr('y', '5').attr('dy', '15px').attr(\"pointer-events\", \"none\");\n  };\n\n  const drawHistogram = svg => {\n    cleanupPrev(svg);\n    const xScaleBins = getXScaleForAxis();\n    const binFunc = d3.bin().value(function (d) {\n      return d.pctOfStart;\n    }).domain([thresholdValues[0], thresholdValues[thresholdValues.length - 1]]).thresholds(thresholdValues);\n    const bins = binFunc(props.metadata);\n    const yScaleBins = d3.scaleLinear().range([boundedHeight, 0]);\n    yScaleBins.domain([0, d3.max(bins, function (d) {\n      return d.length;\n    })]);\n    svg.append(\"g\").attr(\"class\", perRunClass).attr(\"transform\", \"translate(0,\" + boundedHeight + \")\").call(d3.axisBottom(xScaleBins));\n    svg.append(\"g\").attr(\"class\", perRunClass).call(d3.axisLeft(yScaleBins)); // draw the histogram bars \n\n    svg.selectAll(\"rect\").data(bins).enter().append(\"rect\").attr(\"class\", perRunClass).on(\"mouseover\", showTooltip).on('mousemove', handleMouseMove).attr(\"x\", 1).attr(\"transform\", function (d) {\n      return \"translate(\" + xScaleBins(d.x0) + \",\" + yScaleBins(d.length) + \")\";\n    }).attr(\"width\", function (d) {\n      return xScaleBins(d.x1) - xScaleBins(d.x0) - 1;\n    }).attr(\"height\", function (d) {\n      return boundedHeight - yScaleBins(d.length);\n    }).style(\"fill\", \"#69b3a2\");\n  };\n\n  const getTooltipWrapper = () => {\n    return d3.select('#' + ttBinWrapID);\n  };\n\n  const getTooltipBackground = () => {\n    return d3.select('#' + ttBinBackID);\n  };\n\n  const handleMouseOver = e => {\n    getTooltipWrapper().attr('display', null);\n  };\n\n  const showTooltip = d => {\n    getTooltipWrapper().transition().duration(100).style(\"opacity\", 1);\n    getTooltipWrapper().html(\"Range: \" + d.x0 + \" - \" + d.x1).style(\"left\", d3.mouse(this)[0] + 20 + \"px\").style(\"top\", d3.mouse(this)[1] + \"px\");\n  };\n\n  const handleMouseMove = e => {\n    console.log('move');\n    const bisect = d3.bisector(d => d.pctOfStart).left;\n    var xScaleBin = getXScaleForAxis();\n    const coords = d3.pointer(e);\n    const x0 = xScaleBin.invertExtent(coords[0]);\n    /*\n    const oneCycleData = allCycleDataState[0];\n    const i = bisect(oneCycleData, x0, 1);\n    const selectedData = oneCycleData[i];\n    const clientX = xScaleIn(selectedData.age);\n    var tooltipX = clientX;\n    \n    // prevent the tooltip from getting clipped.\n    const tooltipWidth = 75;             \n    if (boundedWidth <= (clientX + tooltipWidth)) {\n        tooltipX = clientX - tooltipWidth;\n    }\n    getTooltipAgeSpan().text('range: ' + selectedData.age);\n     const ttBounds = getTooltipWrapper().node().getBBox();\n    getTooltipBackground()                \n        .attr('width', ttBounds.width)\n        .attr('height', ttBounds.height);\n     getTooltipWrapper().attr(\"transform\", \"translate(\" + tooltipX + \",\" + coords[1] + \")\");  \n    getTooltipWrapper().attr('x', tooltipX);\n    */\n  };\n\n  const handleMouseLeave = () => {\n    getTooltipWrapper().attr('display', 'none');\n  };\n\n  React.useEffect(() => {\n    const svgSelect = '#' + svgID;\n    const svg = d3.select(svgSelect).append(\"g\").attr(\"transform\", marginTranslate);\n    prepTooltip(svg);\n    drawHistogram(svg); // console.log('endvaluechart effect');\n  }, [props]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      id: svgID,\n      width: totalWidth,\n      height: totalHeight,\n      children: /*#__PURE__*/_jsxDEV(\"rect\", {\n        style: {\n          opacity: 0\n        },\n        width: boundedWidth,\n        height: boundedHeight,\n        transform: marginTranslate,\n        fill: \"LightGrey\",\n        onMouseEnter: handleMouseOver,\n        onMouseMove: handleMouseMove,\n        onMouseLeave: handleMouseLeave\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 9\n  }, this);\n}\n\n_s(EndValueChart, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c = EndValueChart;\n;\nexport default EndValueChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"EndValueChart\");","map":{"version":3,"sources":["/Users/paul/OneDrive/Documents/code/src/swrve/src/endvaluechart.js"],"names":["React","d3","useState","EndValueChart","props","maxPctOfStart","maxendvalue","startvalue","svgID","perRunClass","ttBinWrapID","ttBinBackID","ttBinRangeID","margin","top","right","bottom","left","totalWidth","totalHeight","marginTranslate","boundedWidth","boundedHeight","tooltipWidth","tooltipHeight","thresholdValues","cleanupPrev","svg","perRunSelect","selectAll","remove","getXScaleForAxis","numThresholds","length","thresholdRange","thresholdInc","i","scaleThreshold","domain","range","prepTooltip","tooltipWrapper","append","attr","style","tooltipText","drawHistogram","xScaleBins","binFunc","bin","value","d","pctOfStart","thresholds","bins","metadata","yScaleBins","scaleLinear","max","call","axisBottom","axisLeft","data","enter","on","showTooltip","handleMouseMove","x0","x1","getTooltipWrapper","select","getTooltipBackground","handleMouseOver","e","transition","duration","html","mouse","console","log","bisect","bisector","xScaleBin","coords","pointer","invertExtent","handleMouseLeave","useEffect","svgSelect","opacity"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport * as d3 from \"d3\";\nimport {useState} from \"react\";\n\nfunction EndValueChart (props) {\n\n    const maxPctOfStart = props.maxendvalue / props.startvalue;\n    const svgID = 'endvaluechartsvg';\n    const perRunClass = 'perrunevdata';\n    const ttBinWrapID = 'binttwrapper';\n    const ttBinBackID = 'binttback';\n    const ttBinRangeID = 'binrange';\n    const margin = { top: 40, right: 65, bottom: 40, left: 65 };\n    const totalWidth = 960;\n    const totalHeight = 300;\n    const marginTranslate = \"translate(\" + margin.left + \",\" + margin.top + \")\";\n    const boundedWidth = totalWidth - margin.left - margin.right;\n    const boundedHeight = totalHeight - margin.top - margin.bottom;\n    const tooltipWidth = 75;\n    const tooltipHeight = 75;\n    const thresholdValues = [0, 0.25, 0.5, 1, 3, 5, 10, 50];\n\n    const cleanupPrev = (svg) => {\n        const perRunSelect = '.' + perRunClass;\n        d3.selectAll(perRunSelect).remove();\n    }\n\n    const getXScaleForAxis = () => {\n        const numThresholds = thresholdValues.length;\n        var thresholdRange = [];\n        var thresholdInc = boundedWidth / (numThresholds + 1);\n\n        for (var i = 0; i <= thresholdValues.length; i++) {\n            thresholdRange[i] = i * thresholdInc;\n        }\n\n        return d3.scaleThreshold()\n                 .domain(thresholdValues)\n                 .range(thresholdRange);\n    }\n\n    const prepTooltip = (svg) => {\n        // wrapper\n        // background\n        // text element\n        //  tspan for each line\n        //  x0, x1, % of start, % of results\n        const tooltipWrapper = svg.append('g')\n                                  .attr('id', ttBinWrapID)\n                                  .attr('display', 'none');\n        tooltipWrapper.append('rect')\n                      .style('opacity', 0.70)\n                      .attr('id', ttBinBackID)\n                      .attr('width', tooltipWidth)\n                      .attr('height', tooltipHeight)\n                      .attr(\"pointer-events\", \"none\")\n                      .attr(\"fill\", \"#e8e8e8\"); \n        \n        const tooltipText = tooltipWrapper.append('g').append('text');\n        tooltipText.attr(\"pointer-events\", \"none\")\n                   .attr('font-weight', 900)\n                   .attr('text-anchor', 'left');          \n        tooltipText.append('tspan')\n                   .attr('id', ttBinRangeID)\n                   .attr('x', '5')\n                   .attr('y', '5')\n                   .attr('dy', '15px')\n                   .attr(\"pointer-events\", \"none\");\n}\n\n    const drawHistogram = (svg) => {\n        cleanupPrev(svg);\n\n        const xScaleBins = getXScaleForAxis();\n        const binFunc = d3.bin()\n                          .value(function(d) { return d.pctOfStart; })   \n                          .domain([thresholdValues[0], thresholdValues[thresholdValues.length - 1]])\n                          .thresholds(thresholdValues); \n        const bins = binFunc(props.metadata);\n        const yScaleBins = d3.scaleLinear()\n                             .range([boundedHeight, 0]);\n        yScaleBins.domain([0, d3.max(bins, function(d) { return d.length; })]);\n        svg.append(\"g\")\n            .attr(\"class\", perRunClass)\n            .attr(\"transform\", \"translate(0,\" + boundedHeight + \")\")\n            .call(d3.axisBottom(xScaleBins));\n        svg.append(\"g\")\n           .attr(\"class\", perRunClass)\n           .call(d3.axisLeft(yScaleBins));\n\n           // draw the histogram bars \n           svg.selectAll(\"rect\")\n              .data(bins)\n              .enter()\n              .append(\"rect\")\n                .attr(\"class\", perRunClass)\n                .on(\"mouseover\", showTooltip )                \n                .on('mousemove', handleMouseMove)\n                .attr(\"x\", 1)\n                .attr(\"transform\", function(d) { return \"translate(\" + xScaleBins(d.x0) + \",\" + yScaleBins(d.length) + \")\"; })\n                .attr(\"width\", function(d) { return xScaleBins(d.x1) - xScaleBins(d.x0) -1 ; })\n                .attr(\"height\", function(d) { return boundedHeight - yScaleBins(d.length); })\n                .style(\"fill\", \"#69b3a2\");\n    }\n\n    const getTooltipWrapper = () => {\n        return d3.select('#' + ttBinWrapID);\n    }\n\n    const getTooltipBackground = () => {\n        return d3.select('#' + ttBinBackID);\n    }\n\n    const handleMouseOver = (e) => {\n        getTooltipWrapper().attr('display', null);\n    }\n\n    const showTooltip = (d) => {\n        getTooltipWrapper()\n          .transition()\n          .duration(100)\n          .style(\"opacity\", 1)\n        getTooltipWrapper()\n          .html(\"Range: \" + d.x0 + \" - \" + d.x1)\n          .style(\"left\", (d3.mouse(this)[0]+20) + \"px\")\n          .style(\"top\", (d3.mouse(this)[1]) + \"px\")\n    }\n\n    const handleMouseMove = (e) => {\n        console.log('move');\n        const bisect = d3.bisector((d) => d.pctOfStart).left;\n        var xScaleBin = getXScaleForAxis();\n        const coords = d3.pointer(e);\n        const x0 = xScaleBin.invertExtent(coords[0]);\n\n        /*\n        const oneCycleData = allCycleDataState[0];\n        const i = bisect(oneCycleData, x0, 1);\n        const selectedData = oneCycleData[i];\n        const clientX = xScaleIn(selectedData.age);\n        var tooltipX = clientX;\n        \n        // prevent the tooltip from getting clipped.\n        const tooltipWidth = 75;             \n        if (boundedWidth <= (clientX + tooltipWidth)) {\n            tooltipX = clientX - tooltipWidth;\n        }\n        getTooltipAgeSpan().text('range: ' + selectedData.age);\n\n        const ttBounds = getTooltipWrapper().node().getBBox();\n        getTooltipBackground()                \n            .attr('width', ttBounds.width)\n            .attr('height', ttBounds.height);\n\n        getTooltipWrapper().attr(\"transform\", \"translate(\" + tooltipX + \",\" + coords[1] + \")\");  \n        getTooltipWrapper().attr('x', tooltipX);\n        */\n    };\n    \n    const handleMouseLeave = () => {\n        getTooltipWrapper().attr('display', 'none');\n    };\n\n    React.useEffect(() => {\n\n        const svgSelect = '#' + svgID;\n        const svg = d3.select(svgSelect)\n                      .append(\"g\")\n                      .attr(\"transform\", marginTranslate);\n\n        prepTooltip(svg);\n        drawHistogram(svg);\n        // console.log('endvaluechart effect');\n    }, [props] );\n\n    return (\n        <div>\n            <svg id={svgID}  \n                width={totalWidth}\n                height={totalHeight} \n             >\n                <rect\n                    style={{ opacity:0 }}\n                    width={boundedWidth}\n                    height={boundedHeight}\n                    transform={marginTranslate}\n                    fill='LightGrey'\n                    onMouseEnter={handleMouseOver}\n                    onMouseMove={handleMouseMove}\n                    onMouseLeave={handleMouseLeave}\n                 >\n                </rect>\n            </svg>\n        </div>\n    );\n};\n\nexport default EndValueChart;\n"]},"metadata":{},"sourceType":"module"}