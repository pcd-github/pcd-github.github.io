{"ast":null,"code":"var _jsxFileName = \"/Users/paul/OneDrive/Documents/code/src/swrve/src/endvaluechart.js\",\n    _s = $RefreshSig$();\n\nimport * as React from \"react\";\nimport { useState } from \"react\";\nimport * as d3 from \"d3\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction EndValueChart(props) {\n  _s();\n\n  const [binMetadataState, setBinMetadataState] = useState([]);\n  const containerID = 'svgContainer';\n  const svgID = 'endvaluechartsvg';\n  const perRunClass = 'perrunevdata';\n  const margin = {\n    top: 40,\n    right: 65,\n    bottom: 40,\n    left: 65\n  };\n  const totalWidth = 960;\n  const totalHeight = 300;\n  const marginTranslate = \"translate(\" + margin.left + \",\" + margin.top + \")\";\n  const boundedWidth = totalWidth - margin.left - margin.right;\n  const boundedHeight = totalHeight - margin.top - margin.bottom;\n  var tooltipDiv = null;\n  const ttBinDivID = 'ttdiv';\n  const ttColor = 'white';\n  const ttBackColor = 'black';\n  const tooltipWidth = 75;\n  const tooltipHeight = 75;\n  const thresholdValues = [0, 0.25, 0.5, 1, 3, 5, 10, 50];\n\n  const cleanupPrev = svg => {\n    const perRunSelect = '.' + perRunClass;\n    d3.selectAll(perRunSelect).remove();\n  };\n\n  const getXScaleForAxis = () => {\n    const numThresholds = thresholdValues.length;\n    var thresholdRange = [];\n    var thresholdInc = boundedWidth / (numThresholds + 1);\n\n    for (var i = 0; i <= thresholdValues.length; i++) {\n      thresholdRange[i] = i * thresholdInc;\n    }\n\n    return d3.scaleThreshold().domain(thresholdValues).range(thresholdRange);\n  };\n\n  const calcBinMetadata = data => {\n    const oneBinMetadata = {\n      'binData': data,\n      'extBin': d3.extent(data, d => d.adjEndCycleValue),\n      'extPctStartValue': d3.extent(data, d => d.pctOfStart),\n      'binCount': data.length\n    };\n    return oneBinMetadata;\n  };\n\n  const prepTooltip = container => {\n    // wrapper\n    // background\n    // text element\n    //  tspan for each line\n    //  x0, x1, % of start, % of results\n    tooltipDiv = container.append('div').attr('id', ttBinDivID).attr('color', ttColor).attr('background-color', ttBackColor).style('opacity', 0).style(\"border-radius\", \"5px\").style(\"padding\", \"10px\");\n  };\n\n  const drawHistogram = svg => {\n    cleanupPrev(svg);\n    const xScaleBins = getXScaleForAxis();\n    const binFunc = d3.bin().value(function (d) {\n      return d.pctOfStart;\n    }).domain([thresholdValues[0], thresholdValues[thresholdValues.length - 1]]).thresholds(thresholdValues);\n    const bins = binFunc(props.metadata);\n    const yScaleBins = d3.scaleLinear().domain([0, d3.max(bins, function (d) {\n      return d.length;\n    })]).range([boundedHeight, 0]);\n    var binsMeta = [];\n\n    for (var i = 0; i < bins.length; i++) {\n      binsMeta[i] = calcBinMetadata(bins[i]);\n    }\n\n    setBinMetadataState(binsMeta);\n    svg.append(\"g\").attr(\"class\", perRunClass).attr(\"transform\", \"translate(0,\" + boundedHeight + \")\").call(d3.axisBottom(xScaleBins));\n    svg.append(\"g\").attr(\"class\", perRunClass).call(d3.axisLeft(yScaleBins)); // draw the histogram bars \n\n    svg.selectAll(\"rect\").data(bins).enter().append(\"rect\").attr(\"class\", perRunClass).attr(\"x\", 1).attr(\"transform\", function (d) {\n      return \"translate(\" + xScaleBins(d.x0) + \",\" + yScaleBins(d.length) + \")\";\n    }).attr(\"width\", function (d) {\n      return xScaleBins(d.x1) - xScaleBins(d.x0) - 1;\n    }).attr(\"height\", function (d) {\n      return boundedHeight - yScaleBins(d.length);\n    }).style(\"fill\", \"#69b3a2\").on(\"mouseover\", handleMouseOver).on(\"mouseout\", handleMouseLeave).on('mousemove', handleMouseMove);\n  };\n\n  const makeCurrency = num => {\n    let dollarUSLocale = Intl.NumberFormat('en-US', {\n      style: \"currency\",\n      currency: \"USD\"\n    });\n    return dollarUSLocale.format(num);\n  };\n\n  const makePct = num => {\n    return Number(num * 100).toFixed(2) + '%';\n  };\n\n  const getTooltip = () => {\n    return d3.select('#' + ttBinDivID);\n  };\n\n  const handleMouseOver = e => {\n    console.log('over');\n    getTooltip().style('opacity', 1);\n  };\n\n  const handleMouseMove = e => {\n    const coords = d3.pointer(e);\n    const binData = e.srcElement.__data__;\n    const binMeta = calcBinMetadata(binData); // set the tt content\n\n    const tt = getTooltip();\n    const ttContent = ' ' + makeCurrency(+binMeta.extBin[0]) + '-' + makeCurrency(+binMeta.extBin[1]);\n    tt.html(ttContent);\n    console.log('move : ' + binData[0].adjEndCycleValue + ' ' + ttContent); // place the tt\n\n    tt.style('left', coords[0]).style('top', coords[1]);\n  };\n\n  const handleMouseLeave = () => {\n    console.log('leave');\n    getTooltip().style('opacity', 0);\n  };\n\n  React.useEffect(() => {\n    const containerSelect = '#' + containerID;\n    const container = d3.select(containerSelect);\n    const svgSelect = '#' + svgID;\n    const svg = d3.select(svgSelect).append(\"g\").attr(\"transform\", marginTranslate);\n    prepTooltip(container);\n    drawHistogram(svg); // console.log('endvaluechart effect');\n  }, [props]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    id: containerID,\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      id: svgID,\n      width: totalWidth,\n      height: totalHeight,\n      children: /*#__PURE__*/_jsxDEV(\"rect\", {\n        style: {\n          opacity: 0\n        },\n        width: boundedWidth,\n        height: boundedHeight,\n        transform: marginTranslate,\n        fill: \"LightGrey\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 174,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 173,\n    columnNumber: 9\n  }, this);\n}\n\n_s(EndValueChart, \"b9n5mTSe+H/ngodpAp6FIzcAtns=\");\n\n_c = EndValueChart;\n;\nexport default EndValueChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"EndValueChart\");","map":{"version":3,"sources":["/Users/paul/OneDrive/Documents/code/src/swrve/src/endvaluechart.js"],"names":["React","useState","d3","EndValueChart","props","binMetadataState","setBinMetadataState","containerID","svgID","perRunClass","margin","top","right","bottom","left","totalWidth","totalHeight","marginTranslate","boundedWidth","boundedHeight","tooltipDiv","ttBinDivID","ttColor","ttBackColor","tooltipWidth","tooltipHeight","thresholdValues","cleanupPrev","svg","perRunSelect","selectAll","remove","getXScaleForAxis","numThresholds","length","thresholdRange","thresholdInc","i","scaleThreshold","domain","range","calcBinMetadata","data","oneBinMetadata","extent","d","adjEndCycleValue","pctOfStart","prepTooltip","container","append","attr","style","drawHistogram","xScaleBins","binFunc","bin","value","thresholds","bins","metadata","yScaleBins","scaleLinear","max","binsMeta","call","axisBottom","axisLeft","enter","x0","x1","on","handleMouseOver","handleMouseLeave","handleMouseMove","makeCurrency","num","dollarUSLocale","Intl","NumberFormat","currency","format","makePct","Number","toFixed","getTooltip","select","e","console","log","coords","pointer","binData","srcElement","__data__","binMeta","tt","ttContent","extBin","html","useEffect","containerSelect","svgSelect","opacity"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { useState } from \"react\";\nimport * as d3 from \"d3\";\n\nfunction EndValueChart (props) {\n\n    const [binMetadataState, setBinMetadataState] = useState([]);\n\n    const containerID = 'svgContainer';\n    const svgID = 'endvaluechartsvg';\n    const perRunClass = 'perrunevdata';\n    const margin = { top: 40, right: 65, bottom: 40, left: 65 };\n    const totalWidth = 960;\n    const totalHeight = 300;\n    const marginTranslate = \"translate(\" + margin.left + \",\" + margin.top + \")\";\n    const boundedWidth = totalWidth - margin.left - margin.right;\n    const boundedHeight = totalHeight - margin.top - margin.bottom;\n    var tooltipDiv = null;\n    const ttBinDivID = 'ttdiv';\n    const ttColor = 'white';\n    const ttBackColor = 'black';\n    const tooltipWidth = 75;\n    const tooltipHeight = 75;\n    const thresholdValues = [0, 0.25, 0.5, 1, 3, 5, 10, 50];\n\n    const cleanupPrev = (svg) => {\n        const perRunSelect = '.' + perRunClass;\n        d3.selectAll(perRunSelect).remove();\n    }\n\n    const getXScaleForAxis = () => {\n        const numThresholds = thresholdValues.length;\n        var thresholdRange = [];\n        var thresholdInc = boundedWidth / (numThresholds + 1);\n\n        for (var i = 0; i <= thresholdValues.length; i++) {\n            thresholdRange[i] = i * thresholdInc;\n        }\n\n        return d3.scaleThreshold()\n                 .domain(thresholdValues)\n                 .range(thresholdRange);\n    }\n\n    const calcBinMetadata = (data) => {\n        const oneBinMetadata = {\n            'binData': data,\n            'extBin': d3.extent(data, (d) => d.adjEndCycleValue),\n            'extPctStartValue': d3.extent(data, (d) => d.pctOfStart),\n            'binCount': data.length,\n        }\n\n        return oneBinMetadata;\n    }\n\n    const prepTooltip = (container) => {\n        // wrapper\n        // background\n        // text element\n        //  tspan for each line\n        //  x0, x1, % of start, % of results\n\n        tooltipDiv = container.append('div')\n                              .attr('id', ttBinDivID)\n                              .attr('color', ttColor)\n                              .attr('background-color', ttBackColor)\n                              .style('opacity', 0)\n                              .style(\"border-radius\", \"5px\")\n                              .style(\"padding\", \"10px\");\n}\n\n    const drawHistogram = (svg) => {\n        cleanupPrev(svg);\n\n        const xScaleBins = getXScaleForAxis();\n        const binFunc = d3.bin()\n                          .value(function(d) { return d.pctOfStart; })   \n                          .domain([thresholdValues[0], thresholdValues[thresholdValues.length - 1]])\n                          .thresholds(thresholdValues); \n        const bins = binFunc(props.metadata);\n        const yScaleBins = d3.scaleLinear()\n                             .domain([0, d3.max(bins, function(d) { return d.length; })])\n                             .range([boundedHeight, 0]);\n\n        var binsMeta = [];\n        for (var i = 0; i < bins.length; i++) {\n            binsMeta[i] = calcBinMetadata(bins[i]);\n        }\n\n        setBinMetadataState(binsMeta);\n\n        svg.append(\"g\")\n            .attr(\"class\", perRunClass)\n            .attr(\"transform\", \"translate(0,\" + boundedHeight + \")\")\n            .call(d3.axisBottom(xScaleBins));\n        svg.append(\"g\")\n           .attr(\"class\", perRunClass)\n           .call(d3.axisLeft(yScaleBins));\n\n           // draw the histogram bars \n        svg.selectAll(\"rect\")\n           .data(bins)\n           .enter()\n           .append(\"rect\")\n                .attr(\"class\", perRunClass)\n                .attr(\"x\", 1)\n                .attr(\"transform\", function(d) { return \"translate(\" + xScaleBins(d.x0) + \",\" + yScaleBins(d.length) + \")\"; })\n                .attr(\"width\", function(d) { return xScaleBins(d.x1) - xScaleBins(d.x0) -1 ; })\n                .attr(\"height\", function(d) { return boundedHeight - yScaleBins(d.length); })\n                .style(\"fill\", \"#69b3a2\")\n                .on(\"mouseover\", handleMouseOver)\n                .on(\"mouseout\", handleMouseLeave)                \n                .on('mousemove', handleMouseMove);\n    }\n\n    const makeCurrency = (num) => {\n        let dollarUSLocale = Intl.NumberFormat('en-US', {\n            style: \"currency\",\n            currency: \"USD\",\n        });\n        return dollarUSLocale.format(num);\n    }\n\n    const makePct = (num) => {\n        return Number( num * 100).toFixed(2) + '%';\n    }\n\n    const getTooltip = () => {\n        return d3.select('#' + ttBinDivID);\n    }\n\n    const handleMouseOver = (e) => {\n        console.log('over');\n        getTooltip().style('opacity', 1);\n    }\n\n    const handleMouseMove = (e) => {\n        const coords = d3.pointer(e);\n        const binData = e.srcElement.__data__;\n        const binMeta = calcBinMetadata(binData);\n        \n        // set the tt content\n        const tt = getTooltip();\n        const ttContent = ' ' + makeCurrency(+(binMeta.extBin[0])) + '-' + makeCurrency(+(binMeta.extBin[1]));\n        tt.html(ttContent);\n        console.log('move : ' + binData[0].adjEndCycleValue + ' ' + ttContent);\n\n        // place the tt\n        tt.style('left', coords[0])   \n          .style('top', coords[1]);\n    };\n    \n    const handleMouseLeave = () => {\n        console.log('leave');\n        getTooltip().style('opacity', 0);\n    };\n\n    React.useEffect(() => {\n\n        const containerSelect = '#' + containerID;\n        const container = d3.select(containerSelect);\n        const svgSelect = '#' + svgID;\n        const svg = d3.select(svgSelect)\n                      .append(\"g\")\n                      .attr(\"transform\", marginTranslate);\n\n        prepTooltip(container);\n        drawHistogram(svg);\n        // console.log('endvaluechart effect');\n    }, [props] );\n\n    return (\n        <div id={containerID}>\n            <svg id={svgID}  \n                width={totalWidth}\n                height={totalHeight} \n             >\n                <rect\n                    style={{ opacity:0 }}\n                    width={boundedWidth}\n                    height={boundedHeight}\n                    transform={marginTranslate}\n                    fill='LightGrey'\n                 >\n                </rect>\n            </svg>\n        </div>\n    );\n};\n\nexport default EndValueChart;\n"]},"metadata":{},"sourceType":"module"}